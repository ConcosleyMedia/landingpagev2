let postIntegrationStatus=(e,t)=>{},executeWithRetry=(t,e,o,r={})=>{const i={maxRetries:5,retryInterval:2e3,enableLogging:!1,...r};let a=0;const n=()=>{if(e())try{o()}catch(e){i.enableLogging&&console.error(t+" execution failed:",e)}else a<i.maxRetries?(a++,i.enableLogging&&console.warn(`${t} not ready, retrying... (${a}/${i.maxRetries})`),setTimeout(n,i.retryInterval)):i.enableLogging&&console.error(`${t} not ready after ${i.maxRetries} retries`)};n()},enabledform=(window.executeIntegration=(r={},i="mida_conversion")=>{var a=window.md_int_list[r.id];let n=!1;if(!a)return!1;0===Number(r.variant)&&(r.variant="Control");var d=Object.keys(a);if(d.length)for(let e=0;e<d.length;e++)try{let t=d[e],o=a[t];if(o){"gtm"!==t||n||(n=!0,window.dataLayer=window.dataLayer||[],r.event=i,window.dataLayer.push(r),postIntegrationStatus(t,r)),"ga4"===t&&(o.mode&&2===Number(o.mode)&&(!n||n&&"dataLayer"!==o.custom)?("dataLayer"===o.custom&&(n=!0),window[o.custom]=window[o.custom]||[],r.event=i,window[o.custom].push(r)):"function"==typeof gtag?o.format&&2===Number(o.format)?gtag("event",`${i}_${r.id}_`+r.variant.replace(/ /g,"_")):gtag("event",i,r):window.dataLayer&&(o.format&&2===Number(o.format)?window.dataLayer.push({event:`${i}_${r.id}_`+r.variant.replace(/ /g,"_")}):(r.event=i,window.dataLayer.push(r))),postIntegrationStatus(t,r)),"hubspot"===t&&executeWithRetry(t,()=>"undefined"!=typeof _hsq&&_hsq,()=>{try{_hsq.push(["trackCustomBehavioralEvent",{name:"pe_"+i,properties:r}]),postIntegrationStatus(t,null)}catch(e){console.error("Error calling Hubspot integration:",e)}}),"mixpanel"===t&&executeWithRetry(t,()=>"undefined"!=typeof mixpanel&&mixpanel&&"function"==typeof mixpanel.track,()=>{try{mixpanel.track(i,r),postIntegrationStatus(t,r)}catch(e){console.error("Error calling Mixpanel integration:",e)}}),"amplitude"===t&&executeWithRetry(t,()=>"undefined"!=typeof amplitude&&amplitude&&"function"==typeof amplitude.track,()=>{try{amplitude.track(i,r),postIntegrationStatus(t,r)}catch(e){console.error("Error calling Amplitude integration:",e)}}),"klaviyo"===t&&executeWithRetry(t,()=>"undefined"!=typeof klaviyo&&"function"==typeof klaviyo.track||window._learnq,()=>{try{"undefined"!=typeof klaviyo&&"function"==typeof klaviyo.track?klaviyo.track(i,r):window._learnq&&(window._learnq=window._learnq||[],window._learnq.push(["track",i,r])),postIntegrationStatus(t,r)}catch(e){console.error("Error calling Klaviyo integration:",e)}});let e={event:i,test_id:r.id,test_name:r.name,test_variant:r.variant,timestamp:r.timestamp,uuid:window._h_uuid};if("segment"===t&&executeWithRetry(t,()=>"undefined"!=typeof analytics&&analytics,()=>{try{o.mode&&1===Number(o.mode)?(analytics.track(i,r),postIntegrationStatus(t,r)):o.mode&&2===Number(o.mode)?analytics.identify(e):o.mode&&3===Number(o.mode)&&(analytics.track(i,r),analytics.identify(e),postIntegrationStatus(t,r))}catch(e){console.error("Error calling Segment integration:",e)}}),"http_webhook"===t&&(r.endpoint=o.endpoint,r.method=o.method,r.uuid=window._h_uuid,r.key=window._h_key,r.type="mida_conversion"===i?"conversion":"visit",o.status)){try{mida.fetch("/integration/webhook","POST",r,()=>{})}catch(e){console.error(e)}postIntegrationStatus(t,r)}"mc"===t&&executeWithRetry(t,()=>"function"==typeof window.clarity,()=>{try{window.clarity("set",i,`${i}_${r.id}_`+r.variant),postIntegrationStatus(t,`${i}_${r.id}_`+r.variant)}catch(e){console.error("Error calling Microsoft Clarity integration:",e)}}),"hotjar"===t&&executeWithRetry(t,()=>"function"==typeof window.hj||!0,()=>{try{window.hj=window.hj||function(){(hj.q=hj.q||[]).push(arguments)},hj("event",i+"_"+r.id),hj("event",`${i}_${r.id}_`+r.variant),postIntegrationStatus(t,i+("_"+r.id))}catch(e){console.error("Error calling Hotjar integration:",e)}},{maxRetries:5}),"cio"===t&&executeWithRetry(t,()=>"undefined"!=typeof _cio&&"function"==typeof _cio.track||window.cio&&"function"==typeof window.cio.track,()=>{try{"undefined"!=typeof _cio&&"function"==typeof _cio.track?_cio.track(i,r):window.cio&&"function"==typeof window.cio.track&&window.cio.track(i,r),postIntegrationStatus(t,r)}catch(e){console.error("Error calling Customer.io integration:",e)}}),"contentsquare"===t&&executeWithRetry(t,()=>!0,()=>{try{window._uxa=window._uxa||[],window._uxa.push(["trackDynamicVariable",{key:i,value:JSON.stringify({test_id:r.id,test_name:r.name,variant:r.variant,timestamp:r.timestamp})}]),postIntegrationStatus(t,r)}catch(e){console.error("Error calling ContentSquare integration:",e)}},{maxRetries:5})}}catch(e){console.error("Error in window.executeIntegration:",e)}return!0},{}),firedPageviewTests=new Set;mida.fetch("/integration/enabled/"+window._h_key,"GET",null,e=>{try{var a,n=JSON.parse(e);let t=!1,o=!1,r=!1,i=!1;if(n&&n.length){for(let e=0;e<n.length;e++){var d=n[e];d.service.includes("form")&&(enabledform[d.service]=d),"hubspot"===d.service&&(t=!0),"klaviyo"===d.service&&(o=!0),"amplitude"===d.service&&(r=!0),"segment"===d.service&&(i=!0),"ga4"===d.service?(Number(d.mode),d.custom):"gtm"===d.service&&0}("typeform"in enabledform||"tallyform"in enabledform||"jotform"in enabledform||t)&&(a=window.addEventListener?"addEventListener":"attachEvent",(0,window[a])("attachEvent"==a?"onmessage":"message",function(e){e=e[e.message?"message":"data"];"typeform"in enabledform&&e.type&&"form-ready"==e.type&&(enabledform.typeform.formId&&e.formId===enabledform.typeform.formId||enabledform.typeform.formId),"typeform"in enabledform&&e.type&&"form-submit"==e.type&&(enabledform.typeform.formId&&e.formId===enabledform.typeform.formId||!enabledform.typeform.formId)&&(window.mdq?window.mdq.push(["track","typeform-submit",{formId:e.formId}]):mida.track("typeform-submit",{formId:e.formId})),"tallyform"in enabledform&&e.event&&"Tally.FormSubmitted"===e.event&&(enabledform.tallyform.formId&&e.payload.formId===enabledform.tallyform.formId||!enabledform.tallyform.formId)&&(window.mdq?window.mdq.push(["track","tallyform-submit",{formId:e.payload.formId}]):mida.track("tallyform-submit",{formId:e.payload.formId})),"jotform"in enabledform&&e.type&&"submission-completed"===e.action&&(enabledform.jotform.formId&&e.formID===enabledform.jotform.formId||!enabledform.jotform.formId)&&(window.mdq?window.mdq.push(["track","jotform-submit",{formId:e.formID}]):mida.track("jotform-submit",{formId:e.formID})),t&&e.meetingBookSucceeded&&(window.mdq?window.mdq.push(["track","hubspot-meeting-booked",{formId:e.meetingsPayload.formGuid}]):mida.track("hubspot-meeting-booked",{formId:e.meetingsPayload.formGuid})),t&&"hsFormCallback"===e.type&&"onFormSubmitted"===e.eventName&&(window.mdq?window.mdq.push(["track","hubspot-form-submit",{formId:e.id}]):mida.track("hubspot-form-submit",{formId:e.id}))},!1));try{setTimeout(()=>window.mpw(),2e3)}catch(e){console.error("Error in Mida pageview tracking:",e)}if(i&&"undefined"!=typeof analytics&&"function"==typeof analytics.on&&analytics.on("track",function(e,t,o){window.mdq?window.mdq.push(["track",e,t]):mida.track(e,t)}),r&&"undefined"!=typeof amplitude&&"function"==typeof amplitude.logEvent){const m=amplitude.logEvent;amplitude.logEvent=function(e,t){return window.mdq?window.mdq.push(["track",e,t]):mida.track(e,t),m.apply(amplitude,arguments)}}if(o){if("undefined"!=typeof klaviyo&&"function"==typeof klaviyo.track){const c=klaviyo.track;klaviyo.track=function(e,t,o){try{window.mdq?window.mdq.push(["track",e,t]):"undefined"!=typeof mida&&"function"==typeof mida.track&&mida.track(e,t)}catch(e){console.warn("Mida tracking error (Klaviyo continues):",e)}return c.apply(klaviyo,arguments)}}if(window._learnq&&Array.isArray(window._learnq)){const s=window._learnq.push;window._learnq.push=function(){var e,t,o=Array.prototype.slice.call(arguments);try{0<o.length&&Array.isArray(o[0])&&"track"===o[0][0]&&(e=o[0][1],t=o[0][2]||{},window.mdq?window.mdq.push(["track",e,t]):"undefined"!=typeof mida&&"function"==typeof mida.track&&mida.track(e,t))}catch(e){console.warn("Mida tracking error (_learnq continues):",e)}return s.apply(window._learnq,arguments)}}window.addEventListener("klaviyoForms",function(e){"submit"==e.detail.type&&(window.mdq?window.mdq.push(["track","klaviyo-form-submit",{formId:e.detail.formId}]):mida.track("klaviyo-form-submit",{formId:e.detail.formId}))})}}}catch(e){console.error(e)}}),window.mpw=function(e=!1){try{var t=JSON.parse(localStorage.getItem("_variant_result"))||{};if(e)mida.fetch("/test/exposure","POST",{uuid:window._h_uuid,key:window._h_key},e=>{try{var t=JSON.parse(e);t&&t.length&&t.forEach(e=>{var t={id:Number(e.test_id),name:e.test_name,variant:0===e.variant_id?"Control":e.variant_id,uuid:window._h_uuid,timestamp:+new Date};firedPageviewTests.has(e.test_id)||(window.executeIntegration(t,"mida_pageview")&&firedPageviewTests.add(e.test_id),e.complete&&window.executeIntegration(t,"mida_conversion"))})}catch(e){console.error("Error processing test exposure data:",e)}});else{const r=JSON.parse(localStorage.getItem("_abcache"))||[];r.length&&Object.entries(t).forEach(([t,e])=>{var o=r.find(e=>e&&e.test_id&&e.test_id.toString()===t);o&&(o={id:Number(t),name:o.test_name,variant:"0"===e.vaId.toString()?"Control":e.vaId,uuid:e.uuid,timestamp:+new Date},firedPageviewTests.has(t)||(window.executeIntegration(o,"mida_pageview")&&firedPageviewTests.add(t),e.complete&&window.executeIntegration(o,"mida_conversion")))})}}catch(e){console.error("Error in Mida event tracking:",e)}};var referrerDomain=document.referrer?new URL(document.referrer).hostname:"",isExternalReferrer=referrerDomain&&referrerDomain!==window.location.hostname,midaRedirectExists=mida.getCookie("mida_redirect");(isExternalReferrer||midaRedirectExists)&&window.mpw(!0);